<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>RSNA Breast Cancer Detection | Jake Taranov</title> <meta name="author" content="Jake Taranov"> <meta name="description" content="Attempting Detecting breast cancer via mammographic imaging"> <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.21.4/dist/bootstrap-table.min.css"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://jaketaranov.github.io/projects/3_project/"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?96d6b3e1c3604aca8b6134c7afdd5db6"></script> <script src="/assets/js/dark_mode.js?9b17307bb950ffa2e34be0227f53558f"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"><span class="font-weight-bold">Jake </span>Taranov</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about</a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects</a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv</a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">RSNA Breast Cancer Detection</h1> <p class="post-description">Attempting Detecting breast cancer via mammographic imaging</p> </header> <article> <p><a href="https://www.kaggle.com/code/jaketaranov/rsna-breast-cancer-detection" rel="external nofollow noopener" target="_blank">Kaggle Notebook</a></p> <p>As part of a <a href="https://www.kaggle.com/" rel="external nofollow noopener" target="_blank">Kaggle</a> contest hosted by the Radiological Society of North America my peers and myself contributed to help attempt solve the problem of detecting breast cancer through mammographic images. The approach we took can naively be broken up into 4 sections:</p> <ol> <li>loading in the images </li> <li>handling class imbalance</li> <li>training the model</li> <li>analyzing model performance</li> </ol> <h3 id="loading-in-the-images">Loading in the Images</h3> <p>The images were provided in a DICOM (Digital Imaging and Communications in Medicine) format, which is the standard in medical imaging. Initially we wanted to convert the image to a more manageable and manipulatable type, this could be done by converting the image to a 2d array where each index (pixel) represents the brightness on [0,255]. We did not need to consider rgb values since the equipment used for imaging was strictly grayscale. Once the images were converted, we would need to crop the images to be the same size and to only contain the Area of Interest (AOI). The images needed to be the same size so we could pass them into the neural network seamlessly.</p> <p>Given that the data set contained 54,723 images (314.72 GB) we quickly discovered that our plan would not work as efficiently as we needed. The amount of time required to process all these images was unexpected and not practical. Pivoting from our initial plan we researched and found a kaggle dataset from a user who had already done all the required resizing and cropping to provide contestants with. We opted to use these images.</p> <h3 id="handling-class-imbalance">Handling Class Imbalance</h3> <p>After some brief exploration of the data we realized that there was a large discrepancy between the number of cancerous and non-cancerous examples. Approximately 98% of the dataset were non cancerous and a mere 2% were cancerous examples.</p> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/rsna_2-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/rsna_2-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/rsna_2-1400.webp"></source> <img src="/assets/img/rsna_2.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="example image" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <h4 id="image-augmentation-with-undersampling">Image Augmentation with Undersampling</h4> <p>One approach to combat this class imbalance was to use existing cancerous mammograms to help populate the dataset. This was done via PyTorch Transformations. For each example we imposed random rotations up to 60 degrees, and random horizontal and vertical flipping.</p> <div class="row" align="center"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/rsna_3-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/rsna_3-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/rsna_3-1400.webp"></source> <img src="/assets/img/rsna_3.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="example image" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>With the augmentation applied our dataset became less unbalanced having 23% cancerous examples and 77% non cancerous.</p> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/rsna_4-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/rsna_4-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/rsna_4-1400.webp"></source> <img src="/assets/img/rsna_4.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="example image" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>We were still not convinced that even after the augmentation this imbalance will yield optimal performance from the model. The last step we took was to undersample where we used every cancerous example and undersampled the non-cancerous examples for a 50/50 split in training data.</p> <div class="row" align="center"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/rsna_5-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/rsna_5-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/rsna_5-1400.webp"></source> <img src="/assets/img/rsna_5.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="example image" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <h3 id="training-the-model">Training The Model</h3> <p>Due to the discrete and subliminal signs of cancer in the provided imaging, We knew that we needed to use a deep neural network (a neural network with many layers). The more layers we can instantiate in our model, the less <a href="https://en.wikipedia.org/wiki/Bias%E2%80%93variance_tradeoff" rel="external nofollow noopener" target="_blank">bias</a> we hope to have and the more able it is to recognize these subtle characteristics of cancer in mammographic images.</p> <p>The model we selected to use for the classifier was ResNet 18. Residual networks (ResNets) are a popular and effective technique used in image classification. It gained mass popularity around 2016 when it achieved 1st place at the ImageNet Large Scale Visual Recognition Challenge, and a subsequent <a href="https://arxiv.org/abs/1512.03385" rel="external nofollow noopener" target="_blank">paper</a> was released shortly after.</p> <p>The core of ResNet’s power comes from its ability to solve the <a href="https://en.wikipedia.org/wiki/Vanishing_gradient_problem" rel="external nofollow noopener" target="_blank">vanishing gradient problem</a> by using skip connections. The vanishing gradient problem states that in gradient based deep neural networks, when we perform backpropagation the gradient will become vanishingly small, preventing updates of the weights. It is specifically the case when the gradients of the later layers (closer to the output) are less that one, the multiplication of these gradients will cause the updates from the earlier layers (closer to the input) to become functionally obsolete. Skip connections allow us to skip some of these layers that may contain small gradients that prevent us from updating our weights.</p> <div class="row" align="center"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/rsna_6-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/rsna_6-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/rsna_6-1400.webp"></source> <img src="/assets/img/rsna_6.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="example image" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>Some more motivation to use this approach came from a <a href="https://onlinelibrary.wiley.com/doi/abs/10.1002/ima.22698" rel="external nofollow noopener" target="_blank">paper</a> in 2022 that achieved an accuracy of ~98% for detecting breast cancer in histopathological images.</p> <h3 id="analyzing-model-performance">Analyzing Model Performance</h3> <p>After experimenting with the data preparation and tuning <a href="https://en.wikipedia.org/wiki/Hyperparameter_(machine_learning)" rel="external nofollow noopener" target="_blank">hyperparameters</a> we discovered that our model was not performing much better than a random classifier. Looking at the true and false positive rates through a Receiver Operating Characteristics (ROC) curve the performance became clear. Given an optimal ROC curve.</p> <div class="row" align="center"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/rsna_7-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/rsna_7-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/rsna_7-1400.webp"></source> <img src="/assets/img/rsna_7.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="example image" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>In contrast to ours.</p> <div class="row" align="center"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/rsna_8-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/rsna_8-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/rsna_8-1400.webp"></source> <img src="/assets/img/rsna_8.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" title="example image" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>We can clearly see that ours is performing as a random classifier.</p> <p>The general outcome of this Kaggle contest was not too promising. Many teams has results similar to ours where the winning team only had a <a href="https://en.wikipedia.org/wiki/F-score" rel="external nofollow noopener" target="_blank">F1</a> score of 55. Where,</p> \[F_1 = \frac{TP}{TP + \frac{1}{2}(FP + FN)}\] <p>Inherently it is a very difficult problem to solve, which I believe is due to the minute subtlety that signs of cancer may present itself in. While we did not achieve the result we expected or hoped for, it was still an immense learning experience. I was exposed to some new technologies and techniques while also getting to practice and refresh myself on some I may have not used in recent history.</p> </article> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2023 Jake Taranov. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js"></script> <script defer src="https://unpkg.com/bootstrap-table@1.21.4/dist/bootstrap-table.min.js"></script> <script src="/assets/js/no_defer.js?d633890033921b33e0ceb13d22340a9c"></script> <script defer src="/assets/js/common.js?acdb9690d7641b2f8d40529018c71a01"></script> <script defer src="/assets/js/copy_code.js?c9d9dd48933de3831b3ee5ec9c209cac" type="text/javascript"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>